import { cookies } from "next/headers";

export type Lang = "en" | "zh" | "ms";

export const LANG_COOKIE = "bb_lang";
const DEFAULT_LANG: Lang = "en";

const dict: Record<Lang, Record<string, string>> = {
  en: {
    "lang.en": "English",
    "lang.zh": "中文",
    "lang.ms": "Bahasa Melayu",
    "nav.dashboard": "Dashboard",
    "nav.shop": "Shop",
    "nav.products": "Products",
    "nav.orders": "Orders",
    "nav.ai": "AI Marketing",
    "nav.billing": "Billing",
    "nav.settings": "Settings",
    "nav.plan_reviews": "Plan Reviews",
    "topbar.welcome": "Welcome back,",
    "topbar.ai_credits": "AI Credits",
    "sidebar.plan": "Plan",
    "sidebar.seller_os": "Seller OS",
    "plan.active": "Active",
    "plan.free": "Free",
    "home.subtitle": "AI-Powered Digital Bazaar",
    "home.login": "Login",
    "home.admin": "Admin",
    "home.badge": "Modern Digital Bazaar + AI Ops",
    "home.title": "Operate Raya Sales Like a Real SaaS Team",
    "home.desc": "Run shop setup, order tracking, receipt workflow, and AI marketing from one dark-mode control center.",
    "home.b1": "10-minute shop setup",
    "home.b2": "AI marketing tools",
    "home.b3": "Order tracking + receipt",
    "home.welcome": "Welcome Screen",
    "home.welcome_desc": "This is your product-first entry, not a marketing landing page. Login when ready to manage operations.",
    "home.go_login": "Go to Login",
    "home.demo": "View Demo Storefront",
    "auth.title": "AI-Powered Digital Bazaar",
    "auth.desc": "Built for structured seller operations, not generic store pages.",
    "auth.login_title": "Login",
    "auth.login_desc": "Use email + password. New user can register directly.",
    "auth.admin_login": "Admin login",
    "auth.banned": "This account is currently banned. Contact admin support.",
    "auth.feature1": "10-minute shop setup",
    "auth.feature1_desc": "Create a branded storefront and share link quickly.",
    "auth.feature2": "AI marketing tools",
    "auth.feature2_desc": "Generate poster, product background and copy bundle.",
    "auth.feature3": "Order + receipt flow",
    "auth.feature3_desc": "Track proof payment and issue receipt in one panel.",
    "auth.tag.fast": "Fast",
    "auth.tag.ai": "AI",
    "auth.tag.ops": "Ops",
    "form.email": "seller@email.com",
    "form.password": "Password",
    "form.referral": "Referral code (optional)",
    "form.login": "Login",
    "form.register": "Register",
    "form.wait": "Please wait...",
    "form.created": "Account created. If email confirmation is enabled, confirm email first.",
    "form.failed_login": "Login failed",
    "form.failed_register": "Register failed",
  },
  zh: {
    "lang.en": "English",
    "lang.zh": "中文",
    "lang.ms": "Bahasa Melayu",
    "nav.dashboard": "仪表盘",
    "nav.shop": "店铺",
    "nav.products": "产品",
    "nav.orders": "订单",
    "nav.ai": "AI 营销",
    "nav.billing": "账单",
    "nav.settings": "设置",
    "nav.plan_reviews": "配套审核",
    "topbar.welcome": "欢迎回来，",
    "topbar.ai_credits": "AI 点数",
    "sidebar.plan": "配套",
    "sidebar.seller_os": "卖家系统",
    "plan.active": "已启用",
    "plan.free": "免费",
    "home.subtitle": "AI 驱动的数字巴刹",
    "home.login": "登录",
    "home.admin": "管理后台",
    "home.badge": "现代数字巴刹 + AI 运营",
    "home.title": "像专业 SaaS 团队一样运营你的开斋生意",
    "home.desc": "在一个深色控制中心完成开店、订单、收据与 AI 营销。",
    "home.b1": "10 分钟开店",
    "home.b2": "AI 营销工具",
    "home.b3": "订单追踪 + 收据",
    "home.welcome": "欢迎页",
    "home.welcome_desc": "这是产品控制入口，不是营销落地页。准备好后再登录。",
    "home.go_login": "前往登录",
    "home.demo": "查看示例店铺",
    "auth.title": "AI 驱动的数字巴刹",
    "auth.desc": "专为卖家运营设计，不是普通网页商店。",
    "auth.login_title": "登录",
    "auth.login_desc": "使用邮箱+密码登录，新用户可直接注册。",
    "auth.admin_login": "管理员登录",
    "auth.banned": "账号已被封禁，请联系管理员。",
    "auth.feature1": "10 分钟开店",
    "auth.feature1_desc": "快速创建品牌店铺并分享链接。",
    "auth.feature2": "AI 营销工具",
    "auth.feature2_desc": "生成海报、产品背景和文案组合。",
    "auth.feature3": "订单 + 收据流程",
    "auth.feature3_desc": "统一管理付款凭证与收据开立。",
    "auth.tag.fast": "快速",
    "auth.tag.ai": "AI",
    "auth.tag.ops": "运营",
    "form.email": "seller@email.com",
    "form.password": "密码",
    "form.referral": "推荐码（可选）",
    "form.login": "登录",
    "form.register": "注册",
    "form.wait": "请稍候...",
    "form.created": "账号已创建。如启用邮箱验证，请先确认邮箱。",
    "form.failed_login": "登录失败",
    "form.failed_register": "注册失败",
  },
  ms: {
    "lang.en": "English",
    "lang.zh": "中文",
    "lang.ms": "Bahasa Melayu",
    "nav.dashboard": "Papan Pemuka",
    "nav.shop": "Kedai",
    "nav.products": "Produk",
    "nav.orders": "Pesanan",
    "nav.ai": "Pemasaran AI",
    "nav.billing": "Bil",
    "nav.settings": "Tetapan",
    "nav.plan_reviews": "Semakan Pelan",
    "topbar.welcome": "Selamat kembali,",
    "topbar.ai_credits": "Kredit AI",
    "sidebar.plan": "Pelan",
    "sidebar.seller_os": "Sistem Penjual",
    "plan.active": "Aktif",
    "plan.free": "Percuma",
    "home.subtitle": "Bazar Digital Berkuasa AI",
    "home.login": "Log masuk",
    "home.admin": "Admin",
    "home.badge": "Bazar Digital Moden + Operasi AI",
    "home.title": "Urus Jualan Raya Seperti Pasukan SaaS Profesional",
    "home.desc": "Urus kedai, pesanan, resit dan pemasaran AI dalam satu pusat kawalan gelap.",
    "home.b1": "Buka kedai dalam 10 minit",
    "home.b2": "Alat pemasaran AI",
    "home.b3": "Jejak pesanan + resit",
    "home.welcome": "Skrin Selamat Datang",
    "home.welcome_desc": "Ini ialah pintu masuk produk, bukan landing page pemasaran.",
    "home.go_login": "Pergi ke Login",
    "home.demo": "Lihat Demo Kedai",
    "auth.title": "Bazar Digital Berkuasa AI",
    "auth.desc": "Direka untuk operasi penjual yang tersusun.",
    "auth.login_title": "Log masuk",
    "auth.login_desc": "Guna emel + kata laluan. Pengguna baharu boleh daftar terus.",
    "auth.admin_login": "Log masuk Admin",
    "auth.banned": "Akaun ini telah disekat. Sila hubungi admin.",
    "auth.feature1": "Buka kedai dalam 10 minit",
    "auth.feature1_desc": "Cipta storefront berjenama dan kongsi pautan dengan cepat.",
    "auth.feature2": "Alat pemasaran AI",
    "auth.feature2_desc": "Jana poster, latar produk dan bundle copy.",
    "auth.feature3": "Aliran pesanan + resit",
    "auth.feature3_desc": "Urus bukti bayaran dan resit dalam satu panel.",
    "auth.tag.fast": "Pantas",
    "auth.tag.ai": "AI",
    "auth.tag.ops": "Ops",
    "form.email": "seller@email.com",
    "form.password": "Kata laluan",
    "form.referral": "Kod rujukan (pilihan)",
    "form.login": "Log masuk",
    "form.register": "Daftar",
    "form.wait": "Sila tunggu...",
    "form.created": "Akaun berjaya dibuat. Jika pengesahan emel aktif, sahkan emel dahulu.",
    "form.failed_login": "Log masuk gagal",
    "form.failed_register": "Pendaftaran gagal",
  },
};

export function normalizeLang(raw?: string | null): Lang {
  if (raw === "zh" || raw === "ms" || raw === "en") return raw;
  return DEFAULT_LANG;
}

export async function getLangFromCookie(): Promise<Lang> {
  const store = await cookies();
  return normalizeLang(store.get(LANG_COOKIE)?.value);
}

export function t(lang: Lang, key: string) {
  return dict[lang][key] ?? dict.en[key] ?? key;
}

